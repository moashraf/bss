$(document).ready(function(){gallery.initialize()})
var gallery={initialize:function(){if(webkit=!1,isChrome=/chrome/.test(navigator.userAgent.toLowerCase()),isSafari=/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor),(isChrome||isSafari)&&(webkit=!0),currentSlide=null,captionsState="open",0===$("#gallery-wrapper").length){$("body").append('<div id="gallery-wrapper"></div>'),galleryWrapper=$("#gallery-wrapper"),galleryWrapper.hide(),galleryWrapper.click(function(){$(this).find("img").remove(),$(this).find(".img-wrapper-outer-wrapper").remove(),$(this).hide(),console.log("close image viewer"),currentSlide=null}),galleryWrapper.append('<div id="prev-slide" data-title="Previous Image" data-placement="right"><div class="triangle-left"></div></div><div id="next-slide" data-title="Next Image" data-placement="left"><div class="triangle-right"></div></div>')
var e=$("#prev-slide"),i=$("#next-slide")
e.click(function(e){e.stopPropagation(),gallery.doSlide("prev")}),i.click(function(e){e.stopPropagation(),gallery.doSlide("next")}),galleryWrapper.append('<div id="gallery-close" data-title="Close the viewer." data-placement="left">x</div>')
var l=$("#gallery-close")
l.tooltip(),l.click(function(){galleryWrapper.click()})}$(document).keyup(function(e){null!=currentSlide&&(37!=e.keyCode&&40!=e.keyCode||gallery.doSlide("prev"),39!=e.keyCode&&38!=e.keyCode||gallery.doSlide("next"),27==e.keyCode&&l.click())}),galleryWrapper.append('<div id="gallery-counter"><span id="this-slide"></span> of <span id="total-slides"></span></div>'),thisCounter=$("#this-slide"),thisTotal=$("#total-slides"),images=$(".photo-thumbs").find("img"),$.each(images,function(){var e=$(this)
e.on("click",function(){e.closest(".photo-thumbs").find("img").first().attr("src").indexOf("-thumb")>=0?(console.log("using thumbs"),slideThumbs=e.closest(".photo-thumbs").find("img"),slides=slideThumbs.clone(),$.each(slides,function(e){$(this).attr("src",$(this).attr("src").replace("-thumb",""))})):(console.log("NOT using thumbs"),slides=e.closest(".photo-thumbs").find("img").clone()),thisTotal.html(slides.length),$.each(slides,function(i){var l=$(this)
l.hide(),l.attr("src")===e.attr("src").replace("-thumb","")&&(currentSlide=i-1,thisCounter.html(currentSlide+1)),l.click(function(e){e.stopPropagation(),gallery.doSlide("next")})}),galleryWrapper.prepend(slides),webkit?galleryWrapper.css("display","-webkit-box"):(galleryWrapper.addClass("no-webkit"),galleryWrapper.css("display","block")),gallery.doSlide("next")})})},doSlide:function(e){if(console.log("do slide"),"prev"===e&&(0===currentSlide?nextSlide=slides.length-1:nextSlide=currentSlide-1),"next"===e&&(currentSlide===slides.length-1?nextSlide=0:nextSlide=currentSlide+1),$(".caption").remove(),void 0!=$(slides[nextSlide]).data("caption")){$(slides[nextSlide]).wrap('<div class="img-wrapper-outer-wrapper"><div class="img-wrapper-outer"><div class="img-wrapper"></div></div></div>'),$(slides[nextSlide]).parent(".img-wrapper").append('<div class="caption opened">'+$(slides[nextSlide]).data("caption")+'<div class="close-captions" data-title="Minimize captions." data-placement="left">â–¾</div></div>'),"closed"===captionsState&&(console.log("captionsState = "+captionsState),$(".caption").removeClass("opened").addClass("mini closed can-open"))
var i=$(slides[nextSlide]).parent().find(".caption"),l=null,t=null
i.mouseenter(function(e){var i=$(this)
i.hasClass("can-open")&&(null!=l&&clearTimeout(l),i.hasClass("mini")&&i.removeClass("mini"),i.hasClass("closed")&&i.removeClass("closed"),i.hasClass("opened")||(t=setTimeout(function(){i.addClass("opened")},1e3)),i.removeClass("can-open"),captionsState="open")}),i.find(".close-captions").click(function(e){e.stopPropagation()
var i=$(this).parent(".caption")
clearTimeout(t),i.hasClass("opened")&&i.removeClass("opened"),i.addClass("mini"),closedClass=function(){l=setTimeout(function(){i.addClass("closed").addClass("can-open")},800)},closedClass(),captionsState="closed"}).tooltip()}$(slides[currentSlide]).parent().is(".img-wrapper")&&($(slides[currentSlide]).parent().parent().unwrap(),$(slides[currentSlide]).parent().unwrap(),$(slides[currentSlide]).unwrap()),$(slides[currentSlide]).hide(),$(slides[nextSlide]).show(),currentSlide=nextSlide,thisCounter.html(currentSlide+1)}}
